{% extends "base.html" %}
{% block title %}ตะกร้า{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h3 class="mb-0">ตะกร้าสินค้า</h3>
  <a class="btn btn-outline-primary" href="/">เลือกซื้อเพิ่ม</a>
</div>

{% if cart.items.all %}
  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>สินค้า</th>
            <th class="text-end">ราคา</th>
            <th style="width: 220px;">จำนวน</th>
            <th class="text-end">รวมย่อย</th>
            <th class="text-end">ลบ</th>
          </tr>
        </thead>
        <tbody>
          {% for item in cart.items.all %}
          <tr>
            <td class="fw-semibold">{{ item.product.name }}</td>
            <td class="text-end">{{ item.product.price }}</td>
            <td>
              <form method="post" action="{% url 'cart_update_qty' item.id %}" class="d-flex gap-2">
                {% csrf_token %}
                <input type="number" class="form-control" name="qty" value="{{ item.qty }}" min="1">
                <button class="btn btn-outline-primary" type="submit">อัปเดต</button>
              </form>
              <div class="small text-muted mt-1">คงเหลือ {{ item.product.stock }}</div>
            </td>
            <td class="text-end fw-bold">{{ item.subtotal }}</td>
            <td class="text-end">
              <a class="btn btn-outline-danger btn-sm" href="{% url 'cart_remove' item.id %}">ลบ</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="card-body d-flex justify-content-between align-items-center">
      <div class="fs-5">รวมทั้งหมด</div>
      <div class="fs-4 fw-bold">{{ cart.total_price }} ฿</div>
    </div>

    <div class="card-footer bg-white border-0 pb-3">
      <a class="btn btn-success w-100" href="/checkout/">ไปชำระเงิน</a>
    </div>
  </div>
{% else %}
  <div class="alert alert-secondary">
    ตะกร้าว่าง — <a href="/">ไปเลือกสินค้า</a>
  </div>
{% endif %}
{% endblock %}
